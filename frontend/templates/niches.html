<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <!-- <meta name="viewport" content="width=device-width,initial-scale=1" /> -->
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>–í—ã–±–æ—Ä –Ω–∏—à–∏</title>

  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º css -->
  <link rel="stylesheet" href="/static/css/niches.css" />
  <link rel="stylesheet" href="/static/css/styles.css" />

</head>
<body>
  <main class="wrap">
    <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å ‚Äî –ø–æ—Ö–æ–∂–∞—è –Ω–∞ —Å–∫—Ä–∏–Ω: —Ç–µ–º–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å –ø–æ–∏—Å–∫–æ–º –∏ —Ñ–∏–ª—å—Ç—Ä–æ–º -->
    <section class="panel-top">
      <h1 class="panel-title">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h1>

      <div class="controls">
        <label class="search">
          <div class ="icon">
            <img src="/static/images/search_icon.svg" alt="–ü–æ–∏—Å–∫" width="16" height="16" />
          </div>
          <input type="search" id="category-search" placeholder="–ù–∞–π—Ç–∏ —Ç–æ–≤–∞—Ä..." aria-label="–ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º" />
        </label>

        <button id="period-btn" class="period" aria-pressed="false">
          <div class="icon">
            <img src="/static/images/calendar_icon.svg" alt="calendar" width="16" height="16" />
          </div>
          <div class ="period-content">
            <span class="period-text">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π</span>
            <span class="chev">‚Ä∫</span>
          </div>
        </button>
      </div>
    </section>

    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç: –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
    <section id="categories-root" class="categories" role="list">
      {% for cat in categories %}
        <article class="cat-card" data-id="{{ cat.category_id }}" role="listitem">
          <header class="cat-head">
            <div class="cat-image">
              {% set img_url = cat._image_url %}
              {% if img_url %}
                <img src="{{ img_url }}" alt="{{ cat.category_name }}" width="48" height="48" />
              {% else %}
                <div class="thumb-placeholder"><span class="thumb">üì±</span></div>
              {% endif %}
            </div>
            <div class="cat-info">
              <div class="cat-name">{{ cat.category_name }}</div>
            </div>
            {% set children = cat.get('items') or [] %}
            {% if children %}
              <button class="toggle" data-id="{{ cat.category_id }}" aria-expanded="false" title="–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏">
                <img src="/static/images/arrow.svg" alt="–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏" width="16" height="16" />
              </button>
            {% else %}
              <div class="thumb-placeholder"><span class="thumb">üì±</span></div>
            {% endif %}
          </header>

          <!-- –ø—Ä–µ–≤—å—é –∫–∞—Ä—Ç–æ—á–∫–∏ (–º–µ—Ç—Ä–∏–∫–∏) -->
          <div class="cat-metrics">
            <div class="metric">
              <div class="label">–ü—Ä–æ–¥–∞–∂–∏</div>
              <div class="val">{{ "{:,}".format(cat.sale_qty or 0) }}</div>
            </div>
            <div class="metric">
              <div class="label">–í—ã—Ä—É—á–∫–∞</div>
              <div class="val">{{ "{:,}".format(cat.sale_amount or 0) }} ‚Ç∏</div>
            </div>
          </div>

          <!-- –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
          <div class="sublist" data-parent="{{ cat.category_id }}">
            {% if children %}
              {% for sub in children %}
                {% set subchildren = sub.get('items') or [] %}
                <div class="subitem" data-id="{{ sub.category_id }}">
                  <div class="sub-left">
                    {% if subchildren %}
                      <button class="sub-toggle" aria-expanded="false" data-id="{{ sub.category_id }}" title="–ü–æ–∫–∞–∑–∞—Ç—å —É–∑–∫–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏">‚ñ∏</button>
                      <div class="sub-name">{{ sub.category_name }}</div>
                    {% else %}
                      <a class="leaf-link" href="{{ request.url_for('category_page', category_id=sub.category_id) }}">{{ sub.category_name }}</a>
                    {% endif %}
                  </div>

                  <div class="sub-right">
                    <div class="sub-stats">{{ "{:,}".format(sub.sale_qty or 0) }}</div>
                    {% if not subchildren %}
                      <a class="goto" href="{{ request.url_for('category_page', category_id=sub.category_id) }}" aria-label="–ü–µ—Ä–µ–π—Ç–∏ –≤ {{ sub.category_name }}">‚Ä∫</a>
                    {% else %}
                      <span class="goto">‚Ä∫</span>
                    {% endif %}
                  </div>
                </div>

                {% if subchildren %}
                  <div class="sublist inner" data-parent="{{ sub.category_id }}">
                    {% for leaf in subchildren %}
                      <div class="subitem leaf" data-id="{{ leaf.category_id }}">
                        <a class="leaf-link" href="{{ request.url_for('category_page', category_id=leaf.category_id) }}">{{ leaf.category_name }}</a>
                        <div class="sub-right">
                          <div class="sub-stats">{{ "{:,}".format(leaf.sale_qty or 0) }}</div>
                          <a class="goto" href="{{ request.url_for('category_page', category_id=leaf.category_id) }}" aria-label="–ü–µ—Ä–µ–π—Ç–∏ –≤ {{ leaf.category_name }}">‚Ä∫</a>
                        </div>
                      </div>
                    {% endfor %}
                  </div>
                {% endif %}
              {% endfor %}
            {% else %}
              <div class="no-sub">–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–µ—Ç</div>
            {% endif %}
          </div>
        </article>
      {% endfor %}
    </section>

  </main>

  <!-- –°–∫—Ä–∏–ø—Ç -->
  <script src="/static/js/niches.js" defer></script>
</body>
</html>
